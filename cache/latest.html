<html><head>
<meta http-equiv="expires" content="0">
<title>CSG TechNetÂ®</title>
<script src="htm/SubForm.js"></script>

<script type="text/javascript">
<!--


var timerID = null
var timerInterval = (60 * 1000)
//var timerInterval = 5000;
var timeStamp = new Date() - 2000;
var need_skip = false;
var player = null;
var http_request = null;
var hostUrl = location.href.substr(0,location.href.indexOf("?",0)+1);
var playCount = 0;
var repeatTimerID = null;

var fname = "/itab/Alert.mp3";
var waitForTime = 2000;



function repeatAlert() {
  if(player) {
    playCount++;
    try {
      if( playCount < alertPlaybackDuration) {
        repeatTimerID = setTimeout("repeatAlert()", waitForTime);
        player.controls.play();
      }
      else { player = null; }
    } catch (e) {
       console.log(e);
    };
  }
}


var alertPlaybackDuration = Math.floor((30 * 1000) / waitForTime ) ;


function stopclock() {
   if(timerID) clearTimeout(timerID);
   if(http_request)
   {
      try {
         http_request.abort();
      }catch (e) {
	 console.log(e);
      }

      delete http_request;
      http_request = null;
   }
}


function startclock(){ timerID = setTimeout("obtainalert()", timerInterval); }




function showalert(response)
{
  var idx = response.responseText.indexOf("|");
  var nm = response.responseText.substr(0,idx);
  if(nm > 0 ) {
     try {
        numMessages = nm;
        DoUpdate();
     } catch (e) {
	 console.log(e);
     };
  }
 
  var responseText = response.responseText.substr(idx+1);

  if (window.canForceNextEta && responseText.length > 0 && responseText.charAt(0) == '3')
    location.replace(canForceNextEta);

  if (responseText.length > 0 && responseText.charAt(0) == '4')  // GeoFence
  {
    var gList = responseText.substr(1).split('\n');
    alert(gList[0]);
    if(gList[1] == "")
        location.reload();
    else
        location.replace("?" + gList[1]);
  }
  if (responseText.length > 0 && responseText.charAt(0) == '5')  // GeoFenceIsAuto
  {
      var gList = responseText.substr(1).split('\n');
      GeoFenceConfirmation(gList);
  }

  if ( (responseText.length > 2)
      && ((responseText.substr(0, 1) == '0') ||
          (responseText.substr(0, 1) == '1') ||
          (responseText.substr(0, 1) == '2')))
  {
    var alertStatus = responseText.substr(0, 1);
    if(alertStatus == '2') // Tech has been logged out
    {
      alert("Your Session has expired.\nPlease logon."); // Tech has been logged out
      if (window.ReactNativeWebView || isReactNativeWeb) {
        redirectToRefreshHome("Id=1");
      }
      location.replace(hostUrl + "Id=1");
      return;
    }
 
    if(!player) {
      try {
        player = new ActiveXObject("WMPlayer.OCX.7");
      } catch (e) {	    console.log(e);
      }
    }
    if(player) {
      try {
         player.settings.volume=100;
         player.settings.autoStart=false;
         player.URL = fname;
         if (alertPlaybackDuration > 0)
         {
            player.controls.play();
            repeatTimerID = setTimeout("repeatAlert()", waitForTime);
         }
      }catch (err){ alert(err);}
    }
//      alert(responseText.substr(1, responseText.length - 1));
    var msgA = responseText.substr(1, responseText.length - 1).split('\n');
    while (msgA.length > 5) {
      var tA = msgA.splice(0, 5);
      alert(tA.join('\n'));
    }
    alert(msgA.join('\n'));
    playCount = alertPlaybackDuration;

    if (player) {
      try {
        if (alertPlaybackDuration > 0)
        {
           clearTimeout(repeatTimerID);
           player.controls.stop();
           player.settings.mute=true;
           player = null;
        }
      }catch (err) { alert(err); }
    }

    var toUrl;
//     if (alertStatus == 1)
//     {
//       toUrl = hostUrl + "Id=99&Opt=1&Del=1";
//       get_http_request(showalert);
//       if(http_request)
//       {
//           http_request.open('GET', toUrl, true);
//           http_request.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
//           http_request.send(null);
//       }
//     }
//     else
    {
      toUrl = hostUrl + "Id=99&Opt=2";
      get_http_request();
      if(http_request)
      {
          http_request.open('GET', toUrl, true);
          http_request.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
          http_request.send(null);
      }
      timerID = setTimeout("obtainalert()", timerInterval);
    }
  }
  else
  {
    timerID = setTimeout("obtainalert()", timerInterval);
  }
}



function obtainalert()
{
  try {
    playCount = 0;
    var toUrl = hostUrl + "Id=99&Opt=1";
    get_http_request(showalert);
    if(http_request)
    {
       http_request.open('GET', toUrl, true);
       http_request.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
       http_request.send(null);
    }
  } catch (e) {
    alert("Obtainalert failed.");
  }
}

function read_alerts(alertsIds) {
  var newUrl = hostUrl + "Id=99&Opt=5&AlertId=" + alertsIds;
  var http_request = get_http_request();
  http_request.open('GET', newUrl, true);
  http_request.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
  http_request.send(null);
}

function remove_alerts(toUrl) {
  var newUrl = hostUrl + "Id=99&Opt=2";
  var http_request = get_http_request();
  http_request.open('GET', newUrl, true);
  http_request.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
  http_request.send(null);

}


function get_http_request(callback)
{
  if(http_request)
  {
      delete http_request;
      http_request = null;
  }
  
  
  if(window.XMLHttpRequest)
  {
      http_request = new XMLHttpRequest();
  }
  else if (window.ActiveXObject)
  { // IE
     try
     {
       http_request = new ActiveXObject("Msxml2.XMLHTTP");
     }
     catch (e)
     {
        try
        {
          http_request = new ActiveXObject("Microsoft.XMLHTTP");
          need_skip = true;
        }
        catch (e)
        {
          http_request = null;
	  console.log(e);
        }
     }
  }
  

  if(http_request && callback)
  {
    http_request.onreadystatechange =
    function()   {
     if (http_request.readyState == 4)
     {
      if (callback)
      {
          if(need_skip)
          {
             {
                var curStamp = new Date();
                if ( curStamp - timeStamp > 1000 )
                {
                   timeStamp = curStamp;
                   callback(http_request);
                }
                else
                   timeStamp = curStamp;
             }
          }
          else
          {
            callback(http_request);
          }
      }
     }
   }
  }
  return http_request;
}

function initalert()
{
   var data = {responseText:"-1|0"};
   showalert(data);
}


function GeoFenceConfirmation( gList)
{
	 var x = document.createElement("div");
	 x.setAttribute('id', "WarningPan");
	 x.style.width="100%";
	 x.style.height="100%";
	 x.style.top= (document.documentElement.scrollTop || document.body.scrollTop) + 2 + "px";
	 x.style.position="absolute";
	 x.style.textAlign="center";
	 x.style.background="white";
	 
	 var t = document.createElement("div");
	 t.style.margin="0% 10% 0 10%";
	 t.style.textAlign="left";
	 t.innerHTML = "<h3>" + gList[0] + "</h3>";
	 x.appendChild(t);
	 
	 var rBtn = document.createElement("input");
	 rBtn.setAttribute('type', "button");
	 rBtn.value = "Yes";
	 if(rBtn.addEventListener) {
	     rBtn.addEventListener("click", function(){
					    this.disabled = true;
                                            location.replace("?" + gList[1] + "&GeoIsAnswer=Yes");
		 }, false);
	 } else {
	     rBtn.onclick = function () {
		 rBtn.disabled =  true;
		 location.replace("?" + gList[1] + "&GeoIsAnswer=Yes");
	     };
	 };
	 x.appendChild(rBtn);

	 var cBtn = document.createElement("input");
	 cBtn.setAttribute('type', "button");
	 cBtn.style.marginLeft = "1em";
	 cBtn.value = "No";
	 if(cBtn.addEventListener) {
	     cBtn.addEventListener("click", function(){ 
		     this.disabled = true; 
		     location.replace(location.href + "&GeoIsAnswer=No");
		 }, false);
	 } else {
	     cBtn.onclick = function () {
		 cBtn.disabled =  true; 
		 location.replace(location.href + "&GeoIsAnswer=No");
	     };
	 };
	 x.appendChild(cBtn);
	 document.getElementsByTagName("BODY")[0].appendChild(x);
}
-->
</script>

<script type="text/javascript">
<!--
  function get_request()
  {
    var http_request = null;
    if(window.XMLHttpRequest)
    {
      http_request = new XMLHttpRequest();
      if (http_request.overrideMimeType)
      {
	http_request.overrideMimeType('text/xml; charset=ISO-8859-15');
      }
    }
    else if (window.ActiveXObject)
    { // IE
      try
      {
	http_request = new ActiveXObject("Msxml2.XMLHTTP");
      }
      catch (e)
      {
        try
        {
          http_request = new ActiveXObject("Microsoft.XMLHTTP");
          need_skip = true;
        }
        catch (e)
        {
           alert("Can not create http_request");
        }
      }
    }
    return http_request;
  }

  function buildQuery(fm)
  {
    var showStr= "";
    for (i = 0; i < fm.elements.length; i++)
    {
      if (fm.elements[i].disabled == true ||
          (!fm.elements[i].name || fm.elements[i].name == "") ||
          fm.elements[i].type == "button" || 
          fm.elements[i].type == "reset"  ||
          fm.elements[i].name == "dummy_notsentup"  ||
          fm.elements[i].type == "submit" )
      {
        fm.elements[i].disabled = true;
        continue;
      }

      if (showStr.length)
      {
        showStr +='&';
      }

      switch(fm.elements[i].type)
      {
        case "select-one":
          if(fm.elements[i].selectedIndex == -1)
            break;
          curVal = fm.elements[i].options[fm.elements[i].selectedIndex].value;
          if (!curVal)
          {
            curVal = fm.elements[i].options[fm.elements[i].selectedIndex].text;
          }
          showStr += fm.elements[i].name + "=";
          if(curVal)
             showStr += escape(curVal);
          break;

        case "radio" :
          if (fm.elements[i].checked)
          {
            showStr += fm.elements[i].name + "=" + escape(fm.elements[i].value);
          }
          else if (showStr.length)
          {
            showStr = showStr.substr(0, showStr.length-1);
          }
          break;

        case "checkbox":
          showStr += fm.elements[i].name + "=" + fm.elements[i].checked;
          break;

        default :
          showStr += fm.elements[i].name + "=" + escape(fm.elements[i].value);
          break;
      }
    }

//     alert( showStr );
    showStr = showStr.replace(/\+/g, "%2B");
    return showStr;
  }

 function makePOSTRequest(url, parameterStr)
 {
    var req = get_request();
//    alert(wantDataOnly);
    if (req)
    {
      var reqUrl = url || location.href.substr(0, location.href.indexOf('?')) ;
        req.open("POST", url, false);
        req.setRequestHeader('Content-Type', 
			     'application/x-www-form-urlencoded');	
	req.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
	req.send(parameterStr);
	if ( req.status && req.status == 200)
        {
            return req.responseText;
	} else 
        {
	      document.open("text/html", "replace");
	      document.write(req.responseText);
	      document.close();
	}
    } else {
      alert("Can not initiate connection to the server.");
      return '';
    }
 }

 function makeAsyPOSTRequest( reqObj, cb)
 {
    var req = get_request();
    if (req)
    {
        req.open("POST", reqObj.url, true);
        req.setRequestHeader('Content-Type', 
			     'application/x-www-form-urlencoded');	
	req.setRequestHeader("If-Modified-Since", "Sat, 1 Jan 2005 00:00:00 GMT"); // no caching
        req.onreadystatechange = function()
            {
               if (req.readyState == 4 && req.status == 200 && cb)
	       {
	         try { 
                    cb(req.responseText, reqObj);
                 } catch (e) {
                    reqObj.error = e;
                    cb( "ERROR", reqObj, req.responseText );
                 }
               }
            }
	req.send(reqObj.parameters);
    }
 }

-->
</script>

    <link rel="stylesheet" href="htm/Style_BASE.css" type="text/css" media="all">
    <link rel="shortcut icon" href="itab/csglogo.ico">

    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="width">
    <meta name="format-detection" content="telephone=no">
    <meta charset="iso-8859-15">


<style>
table.cal {
  background-color: white;
}

table.cal tr {
  height: 30px;
  border-width: 0;
}

table.cal td.label {
   position: relative;
   top: -15px;
   text-align: center;
   font: normal 12px/25px tahoma,arial,verdana,sans-serif;
   width: 50px;
   padding-left: 3;
}

div.job {
  position:absolute;
  font: normal 11px/15px tahoma,arial,verdana,sans-serif;
  overflow: hidden;

  border-radius: 10px;
  box-shadow: 2px 2px 8px grey;
  border: 1 solid grey;
}

div.oldJob {
  font: normal 11px/15px tahoma,arial,verdana,sans-serif;
  overflow: hidden;
  border-radius: 10px;
  box-shadow: 2px 2px 8px grey;

  border: 1 solid grey;
  margin: 3 3 3 3;
}

div.job div, div.oldJob div {
  padding-right: 10px;
  padding-left: 10px;
}

h5 {
  color: black;
  text-align:center;
  background-color: #98C0F4;
  overflow:hidden;
  font-weight:bold;
  margin: 0 0 0 0 ;
  padding: 0 0 0 0;

  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}

div.shift {
  background-color: #ffefa0;
  opacity: 0.3;
  position:absolute;
}

.IS {
  background-color: #F3FFF5;
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#F3FFF5), to(#CCFFCF));
  background: -moz-linear-gradient(top,#F3FFF5 ,  #CCFFCF); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#F3FFF5, endColorStr=#CCFFCF);
  opacity: 0.8;
}

.job.IS h5, .oldJob.IS h5 {
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#F3FFF5), to(#4E9E4F));
  background: -moz-linear-gradient(top,#F3FFF5 , #4E9E4F); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#F3FFF5, endColorStr=#4E9E4F);
}

.FAILED h5 { color:red; }

.AS {
  background: white;
  opacity: 0.8;
}

.job.AS h5 , .oldJob.AS h5 {
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#98C0F4), to(#5088cc));
  background: -moz-linear-gradient(top,  #98C0F4,  #5088cc); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#98C0F4, endColorStr=#5088cc);
}

.job.AS.E, .job.ND.E  {
  background-color: #F9FFDA;
}

.job.AS.E h5, .job.ND.E h5 {
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#98C0F4), to(#4E9E4F));
  background: -moz-linear-gradient(top,  #98C0F4,  #4E9E4F); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#98C0F4, endColorStr=#4E9E4F);
}

.CP {
  background: lightgrey;
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(white), to(grey));
  background: -moz-linear-gradient(top, white, grey); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=white, endColorStr=grey);
  opacity: 0.8;
}
.job.CP h5, .oldJob.CP h5 {
  background-color: lightgrey;
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(white), to(grey));
  background: -moz-linear-gradient(top, white, grey); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=white, endColorStr=grey);
}

.CN {
  background: grey;
  color:red !important;
  opacity: 0.5;
}

.job.CN h5, .oldJob.CN h5 {
  color: white ;
  background: black;
}

.ND {
  background-color: #FFCCCF;
  opacity: 0.8;
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFF3F5), to(#FFCCCF));
  background: -moz-linear-gradient(top,#FFF3F5 ,  #FFCCCF); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#FFF3F5, endColorStr=#FFCCCF);
}
.job.ND h5, .oldJob.ND h5 {
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFF3F5), to(#9e4b4F));
  background: -moz-linear-gradient(top,#FFF3F5 ,  #9e4b4F); /* for firefox 3.6+ */ 
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#FFF3F5, endColorStr=#9e4b4F);
}

div.timerline {
  position:absolute;
}
div.timerline .dot {
  height: 1px;
  width: 1px;
  background-color: red;
  margin: 0 0 0 0;
  float:left;
  border: 2px solid red;
  border-radius: 10px;

}
div.timerline h5 {
  height: 1px;
  background-color: red;
  margin: 2px 0 2px 0;
}

div.dayBlock {
  overflow: visible;
  background-color: #fffce0;
  width:99.5%;
  margin: 0 0 6 0;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

div.dayBlock h4 {
  color: white;
  text-align:center;
  background: #98C0F4;
  overflow:hidden;
  font-weight:bold;
  background-color: blue;
  margin: 0 0 0 0 ;
  padding: 2px 0 2px 0;

  background: -webkit-gradient(linear, 0% 20%, 0% 100%, from(#9C7872), to(#7c5852));

  background: -moz-linear-gradient(top, #7C5852, #2a140e);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#efefff, endColorStr=grey);

  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

div.dayBlock > div, span {
  margin-left: 10px;
}

div.dayBlock div.oldJob {
  height: 60px;
}

#pastJobs {
}

div.table {
   display:table;
   width:95%;
}

div.row { 
  display:table-row;
} 

div.bullet {
 display:table-cell;
 vertical-align: middle;
 text-align:right; 
 width: 20px;
 height: 20px;
 background-image:url('htm/bullet_steel.png');
 background-position:center; 
 background-repeat:no-repeat;
 background-size:12px;
}

div.tcell {
   display:table-cell;
   vertical-align: middle;
   text-align:right;
   font: bold 11px/15px tahoma,arial,verdana,sans-serif;
   vertical-align:middle;
   width: 40px;
   padding-right: 5px;
}

div.jcell {
    display:table-cell;
    vertical-align: middle;
}

#detailPan {
  position:absolute;
  z-index:50;
  opacity: 1;

  border: 1 solid black;
  overflow-y: visible;
  overflow-wrap: anywhere;
  border-radius: 10px;
  box-shadow: 2px 2px 8px black;
}

#curDay h4 {
     text-align: center;
     color: white;
     background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#98C0F4), to(#5080cc));
     background: -moz-linear-gradient(top,  #98C0F4,  #5088cc); /* for firefox 3.6+ */ 
     filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#98C0F4, endColorStr=#5088cc);
     padding: 2px;
     margin: 10 0 0 0;
     border-top-left-radius: 9px;
     border-top-right-radius: 9px;
}
h3.title {
     text-align: center;
     color: white;
     background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#5088cc), to(#151b54));
     background: -moz-linear-gradient(top,  #5088cc,  #151b54); /* for firefox 3.6+ */ 
     filter:progid:DXImageTransform.Microsoft.gradient(startColorStr=#5088cc, endColorStr=#151b54);
     padding: 10px;
     margin: 0 0 0 0;
     min-height:20px;
     border-top-left-radius: 9px;
     border-top-right-radius: 9px;
}

h3.title > span:first-child {
   float:right;
   margin: 0 10 0 0 ;
   color:red;
   display:inline;
   font-size:18pt;
   cursor: default;
}

.button.mail {
  display:inline-table;
  background-image:url(itab/Mail.png);
  background-repeat:no-repeat;
  background-origin: content-box;
  background-position:center;
  border: 0;
  margin: 0 1em 0 0.5em;
  color: blue;
  background-color: transparent;
  border-radius: 0px;
  height: 1.8em;
  width: 3em;
  box-shadow: 2px 2px 5px #888888;
  float:right;
}
.bell-button {
  position: absolute;
  top: 2.6em;
  right: 4.3em;
  width: 32px;
  height: 32px;
  background-image: url(itab/notification.svg);
  background-position: center center;
  background-repeat: no-repeat;
  background-origin: content-box;
}
.bell-button .red-dot {
    position: absolute;
    right: 6px;
    top: 12px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #FF0000;
}
</style>
<script type="text/javascript">
<!--
var numMessages;

  function DoUpdate()
  {
      document.getElementById('MsgCountID').innerHTML = numMessages;
  }

  if (   (location.href.indexOf("Id", 0) == -1) 
      || (location.href.indexOf("Id=27&FcIdsOnly=", 0) != -1)) 
  {
    var host = location.href.indexOf("?");
    host = (host > 0) ? location.href.substr(0,location.href.indexOf("?", 0)+1) : location.href + "?";
    var url = host + "Id=28";
    location.replace(url);
  }

   var curTechStatus = "LoggedOn";

   function changeStatus(mv)
   {
     if (mv == "-2") return;


     document.choices.mainVal.value=mv


     if( mv == 13)
     {
       document.choices.Id.value="72";
       if(document.forms[0].woNumAndJob.type == "select-one") {
          document.forms[0].woNumAndJob.selectedIndex = 0;
          document.forms[0].woNumAndJob.options[0].value = "-99:-99:1";
       }
     }


     if( 0 && mv == '6' && document.choices.TsVal.value != "ENROUTE" && curTechStatus != "LoggedOn" && curTechStatus != "Unknown" && curTechStatus != "Wrapup")
     {
         var resp = makePOSTRequest("technet.htm?", buildQuery(document.choices) + "&Ajax=1" );
         var x = resp.split('|');
         if(x[0] == 1) {
           var nT = (curTechStatus == "OnJob" ? "GoBackOnJob" : curTechStatus);
           var nV = (nT == 'Available') ? 'AVAIL' : (nT == "GoBackOnJob" ? "ONJOBT" : nT.toUpperCase());
           curTechStatus =  document.choices.techStatus.options[document.choices.techStatus.selectedIndex].text;
           document.choices.techStatus.options[document.choices.techStatus.selectedIndex].text = nT;
           document.choices.techStatus.options[document.choices.techStatus.selectedIndex].value = nV;
           document.getElementById('ts').innerHTML = curTechStatus;
           document.choices.techStatus.selectedIndex = 0;
         } else {
           alert(x[1]);
         }
         var btns = document.getElementsByTagName('INPUT');
         for(var i=0; i < btns.length; i++)
           if(btns[i].type == 'button') btns[i].disabled = false;
         return true;
     }
	  if( mv == '6' ) {
			document.choices.trackGps.value =  document.choices.techStatus.options[document.choices.techStatus.selectedIndex].getAttribute("trackGps") || 0;
	      if(document.choices.trackGps.value == 1) {
				 if (navigator.geolocation)
				 {
					  navigator.geolocation.getCurrentPosition(
							function (loc) { 
								 document.choices.Latitude.value = loc.coords.latitude;
								 document.choices.Longitude.value = loc.coords.longitude;
								 document.choices.Speed.value = loc.coords.speed || '';
                 document.choices.XgeoX.value = 'geoData';
								 sub_it(document.choices);
							},
							function (geoPositionError) {
                 var reason = "";
								 switch (geoPositionError.code) {
									  case 0: // UNKNOWN_ERROR
											reason = "An unknown error occurred, sorry";
									  break;
									  case 1: // PERMISSION_DENIED
											reason = "Permission to use Geolocation was denied";
									  break;
									  case 2: // POSITION_UNAVAILABLE
											reason = "Could not find you";
									  break;
									  case 3: // TIMEOUT
											reason = "The Geolocation request took to long and timed out";
									  break;
									default:
								 }
                 document.choices.Latitude.value = "";
                 document.choices.Longitude.value = "";
                 document.choices.Speed.value = "";
                 document.choices.XgeoX.value= 'geoError: ' + reason;
								 sub_it(document.choices);
							},
              { timeout: 4000, maximumAge: 60000, enableHighAccuracy: true } );
					  return  document.choices.techStatus.disabled = true;
				 } else {
            document.choices.XgeoX.value = 'geoNoNav';
					  //alert("I am sorry, but Geolocation is not supported in your current browser");
				 }
			}
	  }
     sub_it(document.choices);
     return true;
   }

   var hashObj = new Object();
   var pastObj = new Object();

   var jobObj =  new Object();
   var ackObj =  new Object();


     hashObj["078361428391201203:07836142839:1"] = {"woNumber":"078361428391201203:07836142839:1","isComplexJob":0,"Symbol":"","drawStartTime":"08:06","woJobNumber":"07836142839 [CP:8-11:IN]","drawAdjustedDuration":"90","techScheduledEvent":0,"drawTotalDuration":"180","drawDuration":"90","drawEndTime":"10:19","drawState":"CP","lineItems":["<b>Job ID:</b> 07836142839","<b>Tech:</b> 18232","<b>ResCd:</b> None","<b>FC:</b> 178014134","<b>Create:</b> 12/03/2025 20:10","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 10:19","<b>DS:</b> Complete","<b>TS:</b> 8-11","<b>Type:</b> IN","<b>Units:</b> 15","<b>ReaCd/ReaDesc:</b> [33:Code Change][2:Rec Primary Video][33:Code Change][11:Install A/O][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][165:Stream]","<b>Addr:</b> 1831 FULTON ST","<b>Addr2:</b> APT 1C","<b>City:</b> BROOKLYN, NY 11233-2210","<b>Name:</b> BREVOORT,RESIDENT","<b>Home #:</b> 347-683-1230","<b>Work #:</b> 347-683-1230","<b>Map CD:</b>  39Z","<b>Job Cmt:</b> Waiting for customer","<b>Node:</b> 35D165","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Checked wires, signals, installed new modem 3.1. Customer educated","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawStartDate":"2025/12/08"};

     jobObj["078361428391201203:07836142839:1"] = "07836142839 [CP:8-11:IN]";
     hashObj["0783606893406A1203:07836068934:1"] = {"woNumber":"0783606893406A1203:07836068934:1","isComplexJob":0,"Symbol":"","drawStartTime":"10:33","woJobNumber":"07836068934 [CP:11-2:COS]","drawAdjustedDuration":"0","drawTotalDuration":"54","techScheduledEvent":0,"drawEndTime":"11:28","drawDuration":"54","drawStartDate":"2025/12/08","lineItems":["<b>Job ID:</b> 07836068934","<b>Tech:</b> 18232","<b>ResCd:</b> None","<b>FC:</b> 178014134","<b>Create:</b> 12/03/2025 15:38","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 11:28","<b>DS:</b> Complete","<b>TS:</b> 11-2","<b>Type:</b> COS","<b>Units:</b> 9","<b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][29:Up/Down Serv]","<b>Addr:</b> 674 MADISON ST","<b>Addr2:</b> APT 2","<b>City:</b> BROOKLYN, NY 11221-2106","<b>Name:</b> TYBERG,JAMIE","<b>Home #:</b> 404-483-9463","<b>Work #:</b> 404-483-9463","<b>Map CD:</b>  41Y","<b>Job Cmt:</b> ","<b>Node:</b> 35C165","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Rebooted modem, changing service","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawState":"CP"};

     jobObj["0783606893406A1203:07836068934:1"] = "07836068934 [CP:11-2:COS]";
     hashObj["0783655041201y1208:07836550412:1"] = {"woJobNumber":"07836550412 [CP:11-2:TC]","drawStartTime":"11:42","Symbol":"","woNumber":"0783655041201y1208:07836550412:1","isComplexJob":0,"lineItems":["<b>Job ID:</b> 07836550412","<b>Tech:</b> 18232","<b>ResCd:</b> [213][261]","<b>FC:</b> 178014134","<b>Create:</b> 12/08/2025 09:40","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 12:55","<b>DS:</b> Complete","<b>TS:</b> 11-2","<b>Type:</b> TC","<b>Units:</b> 18","<b>ReaCd/ReaDesc:</b> [402:2nd Repeat TC][162:HSD /Intermt/A-Otlts][200:Diagnosis/Check Grnd][915:MedLifeAlrt][336:Svc Call Fee Waived][902:OASPRI]","<b>Addr:</b> 301 STERLING ST","<b>Addr2:</b> APT 5H","<b>City:</b> BROOKLYN, NY 11225-4140","<b>Name:</b> TURNER,DOROTHY","<b>Home #:</b> 718-773-4631","<b>Work #:</b> 917-294-8088","<b>Map CD:</b>  33T","<b>Job Cmt:</b> (917)294-8088","<b>Node:</b> 35E128","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Changed fittings, removed unnecessary splitters  ","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawStartDate":"2025/12/08","drawState":"CP","drawEndTime":"12:55","drawDuration":"108","drawTotalDuration":"108","techScheduledEvent":0,"drawAdjustedDuration":"0"};

     jobObj["0783655041201y1208:07836550412:1"] = "07836550412 [CP:11-2:TC]";
     hashObj["0783654398203H1205:07836543982:1"] = {"techScheduledEvent":0,"drawTotalDuration":"54","drawAdjustedDuration":"0","drawState":"CP","drawStartDate":"2025/12/08","lineItems":["<b>Job ID:</b> 07836543982","<b>Tech:</b> 18232","<b>ResCd:</b> None","<b>FC:</b> 178014134","<b>Create:</b> 12/05/2025 10:40","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 14:50","<b>DS:</b> Complete","<b>TS:</b> 11-2","<b>Type:</b> COS","<b>Units:</b> 9","<b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][33:Code Change][29:Up/Down Serv]","<b>Addr:</b> 57 LINCOLN RD","<b>Addr2:</b> APT B14","<b>City:</b> BROOKLYN, NY 11225-4058","<b>Name:</b> LIENKE,JULIA","<b>Home #:</b> 323-481-5023","<b>Work #:</b> 323-481-5023","<b>Map CD:</b>  33R","<b>Job Cmt:</b> ","<b>Node:</b> 35E431","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Changed fitting, checked signals, swap modem, provision 1G internet speed. Customer educated.","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawDuration":"54","drawEndTime":"14:50","Symbol":"","woNumber":"0783654398203H1205:07836543982:1","isComplexJob":0,"woJobNumber":"07836543982 [CP:11-2:COS]","drawStartTime":"13:08"};

     jobObj["0783654398203H1205:07836543982:1"] = "07836543982 [CP:11-2:COS]";
     hashObj["078368653810661207:07836865381:1"] = {"drawDuration":"54","drawEndTime":"16:20","drawState":"CP","drawStartDate":"2025/12/08","lineItems":["<b>Job ID:</b> 07836865381","<b>Tech:</b> 18232","<b>ResCd:</b> [111][280]","<b>FC:</b> 178014134","<b>Create:</b> 12/07/2025 13:22","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 16:20","<b>DS:</b> Complete","<b>TS:</b> 2-5","<b>Type:</b> TC","<b>Units:</b> 9","<b>ReaCd/ReaDesc:</b> [153:Slow Internet Speed][200:Diagnosis/Check Grnd]","<b>Addr:</b> 177 WOODRUFF AV","<b>Addr2:</b> APT 101","<b>City:</b> BROOKLYN, NY 11226","<b>Name:</b> QUIRICO,QUINCY","<b>Home #:</b> 347-772-7937","<b>Work #:</b> 347-772-7937","<b>Map CD:</b>  31R","<b>Job Cmt:</b> 3477727937","<b>Node:</b> 32E101","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Ran new drop wires, rebooted modem.","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawAdjustedDuration":"0","techScheduledEvent":0,"drawTotalDuration":"54","drawStartTime":"15:04","woJobNumber":"07836865381 [CP:2-5:TC]","isComplexJob":0,"woNumber":"078368653810661207:07836865381:1","Symbol":""};

     jobObj["078368653810661207:07836865381:1"] = "07836865381 [CP:2-5:TC]";
     hashObj["0783680049702C1204:07836800497:1"] = {"drawAdjustedDuration":"0","drawTotalDuration":"66","techScheduledEvent":0,"drawEndTime":"19:00","drawDuration":"66","drawStartDate":"2025/12/08","lineItems":["<b>Job ID:</b> 07836800497","<b>Tech:</b> 18232","<b>ResCd:</b> None","<b>FC:</b> 178014134","<b>Create:</b> 12/04/2025 19:42","<b>Schd:</b> 12/08/2025","<b>CpTime:</b> 12/08/2025 19:00","<b>DS:</b> Complete","<b>TS:</b> 2-5","<b>Type:</b> IN","<b>Units:</b> 11","<b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][15:Rec PriInternet&Soft]","<b>Addr:</b> 45 HINCKLEY PL","<b>Addr2:</b> APT 5C","<b>City:</b> BROOKLYN, NY 11218","<b>Name:</b> RAHMAN,MAISHA","<b>Home #:</b> 917-232-4238","<b>Work #:</b> 917-232-4238","<b>Map CD:</b> 992-","<b>Job Cmt:</b> ","<b>Node:</b> 32E221","<b>Delq:</b> ","<b>Dispatch Cmt:</b> Checked signals, installed new modem 3.1","<b>Receipt Cmt:</b> ","<b>FSM Cmt:</b> "],"drawState":"CP","woNumber":"0783680049702C1204:07836800497:1","isComplexJob":0,"Symbol":"","drawStartTime":"16:37","woJobNumber":"07836800497 [CP:2-5:IN]"};

     jobObj["0783680049702C1204:07836800497:1"] = "07836800497 [CP:2-5:IN]";

var lockedWos = {};

       function woSelect (e) {
                  var event = e || window.event;
                  var src = this.getAttribute('id');
                  var d = document.getElementById('detailPan');
                  d.className = this.className;
//                  d.innerHTML = this.innerHTML;
                  var selObj = hashObj[this.getAttribute('id')] || pastObj[this.getAttribute('id')];
                  var iHtml = '<table style="width:100%;">';
                  iHtml += '<tr><td>' + selObj.lineItems.join('<br/>');
                  if(selObj.techScheduledEvent && selObj.techScheduledEvent ==1)
                  {
                     iHtml += '<br/><table width=100% ><tr style="border:0" ><td align=center>';
                     if( selObj.showStart ==1  )
                        iHtml +='<input type=button value="Start" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + selObj.woNumber + '&Action=START\')" />';
                     if(selObj.showSkip ==1)
                        iHtml += '<input type=button value="Skip" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + selObj.woNumber + '&Action=SKIP\')" />';
                     if(selObj.showComplete == 1)
                        iHtml +='<input type=button value="Complete" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + selObj.woNumber + '&Action=COMPLETE\')" />';
                     iHtml += '</td></tr></table><br/><p><p></td></tr></table>';
                     d.innerHTML = '<h3 class="title">' + selObj.woJobNumber + '<span onclick="document.getElementById(\'detailPan\').style.display=\'none\'; return false;"> &#x2716; </span></h3>';
                  } else {
                     iHtml += '</td></tr></table>';
                     if(!lockedWos[selObj.woNumber.split(":")[0]])
								 iHtml = '<div><div style="float:right; position:relative; top: 5px;"> <input type="button" value="Go" onclick="document.forms[0].woNumAndJob.value=\'' + selObj.woNumber + '\';on_click(this);return false;"></div>' + iHtml + '</div>';
                     else
								 iHtml = '<div><div style="text-align:center; color: red;font-size:1.5em;">The job is locked.</div>' + iHtml + '</div>';
                     ackObj[selObj.woNumber] = 1
                     d.innerHTML = '<h3 class="title">' + selObj.Symbol + selObj.woJobNumber + '<span onclick="document.getElementById(\'detailPan\').style.display=\'none\'; return false;"> &#x2716; </span></h3>';
                  }
                  d.innerHTML += iHtml;
//                  console.log(d.innerHTML);
                  d.style.display="";
                  var calBox = document.getElementById('calDiv');
                  var rect = calBox.getClientRects()[0];

                  for (var topPos = 0,  el = this;  el != null; topPos += el.offsetTop, el = el.offsetParent);
                  for (var leftPos = 0, el = this;  el != null; leftPos += el.offsetLeft, el = el.offsetParent);

                  d.style.top = selObj.lineItems.length <= 5 ?  topPos + 15 : document.body.scrollTop || document.documentElement.scrollTop;
                  d.style.left = 2;
                  d.style.width = rect.right - rect.left -3;
           };


  function sss(vselect)
  {
//    alert("updating textarea");
//    alert(vselect);
      var selObj = hashObj[vselect];
    var iHtml = selObj.lineItems.join('<br/>');
    if(selObj.techScheduledEvent && selObj.techScheduledEvent ==1)
    {
        document.getElementById("goBtn").disabled = true;

        iHtml += '<br/><table width=100% ><tr style="border:0" ><td align=center>';
        if( selObj.showStart ==1  )
            iHtml +='<input type=button value="Start" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + vselect + '&Action=START\')" /> ';
        if(selObj.showSkip ==1)
               iHtml += '<input type=button value="Skip" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + vselect + '&Action=SKIP\')" /> ';
        if(selObj.showComplete == 1)
            iHtml +='<input type=button value="Complete" onclick="this.disabled = true;location.replace(\'?Id=137&TseId=' + vselect + '&Action=COMPLETE\')" />';
        iHtml += '</td></tr></table><br/><p><p>';
    }
    else
    {
		  document.getElementById("goBtn").disabled =  (selObj.woNumber && !lockedWos[selObj.woNumber.split(":")[0]]) ? false : true;
    }

    document.getElementById("dummy_notsentup").innerHTML = iHtml;

    if (vselect.substr(0, 6) != "TSEID-")
    {
      ackObj[vselect] = 1;
    }
  }

function ackList ()
{
var arrStr = "";
for (var i in ackObj) {
var curStr = (i.split(":"))[0] ;
if ( arrStr.length > 0 )        
 arrStr +=":";
arrStr += curStr;
}
return arrStr;
}
function on_click(btn)
{
  btn.disabled = true;
  document.forms[0].dummy_notsentup ? document.forms[0].dummy_notsentup.value="" : '';
  document.choices.Id.value="24";
  document.forms[0].ackJobList.value=ackList();
  sub_it(document.forms[0]);
}

var startDayAt;
var dayEnd;
var myOrder = [];
var dayLength = 48*60;
var shifts = [{"ss":"08:00","se":"18:00"}];


function on_load()
{
  setTimeout(() => {
    if (window.ReactNativeWebView || isReactNativeWeb) {
      redirectToRefreshHome('Id=28')
    }
  },100)
//  Process past jobs
    var pastDate = new Object();

    for( var wo in pastObj ) {
		  pastObj[wo].Symbol = pastObj[wo].isComplexJob ? "&#9783; " : "";
       pastObj[wo].order = 0;
       if(pastObj[wo].drawStartTime == undefined)
          pastObj[wo].drawStartTime = '8:00';
       if(pastObj[wo].drawStartDate == undefined)
          continue;
       if(!pastDate[pastObj[wo].drawStartDate]) pastDate[pastObj[wo].drawStartDate] = [];
          pastDate[pastObj[wo].drawStartDate].push(pastObj[wo]);
    }

    var pBox = document.getElementById("pastJobs");
    for (var pDate in pastDate) {
          var dB = document.createElement("div");
          dB.className = "dayBlock";
          var d = new Date();
          var dA = pDate.split('/');
          d.setFullYear(dA[0]);
          d.setMonth(dA[1] - 1);
          d.setDate(dA[2]);
          dB.innerHTML = "<h4> " + d.toLocaleDateString(navigator.language, { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' } ) + "</h4>";
          var t = document.createElement("div");
          t.className = "table";
          dB.appendChild(t);
          var jL = pastDate[pDate];
          jL.sort(function(a,b) { return a.drawStartTime >= b.drawStartTime ? 1 : -1; } );
          for(var w=0; w < jL.length; w++ ) {
            wo = jL[w].woNumber;
            var woObj = pastObj[wo];
            var r = document.createElement("div");
            r.className = "row";
            t.appendChild(r);
            var b = document.createElement("div");
            b.className = "bullet";
            r.appendChild(b);
            var m = document.createElement("div");
            m.className = "tcell";
            m.innerHTML = woObj.drawStartTime;
            r.appendChild(m);
            var j = document.createElement("div");
            j.className = "jcell";
            r.appendChild(j);
            
            var x = document.createElement("div");
            x.setAttribute('id', wo);
            x.className = "oldJob " +  ( woObj.drawState || woObj.woJobNumber.substr(woObj.woJobNumber.indexOf('[')+1, 2) );
            x.innerHTML =  "<h5>" + woObj.Symbol + woObj.woJobNumber + "</h5><div>" + woObj.lineItems.join('<br/>') + '</div>';
            r.appendChild(x);

            if(x.addEventListener) {
              x.addEventListener("click", woSelect, false);
            } else {
              x.onclick = woSelect;
            }
          }
          pBox.appendChild(dB);
    }

//    var shiftBegin = "-40:00"; 
//    var shiftEnd = "29:00" ;
    var shiftBegin = "24:00"; 
    var shiftEnd = "00:00" ;


    for ( var i = 0; i < shifts.length; i++ )
    {
        if ( shiftBegin > shifts[i].ss ) shiftBegin = shifts[i].ss;
        if ( shiftEnd   < shifts[i].se ) shiftEnd = shifts[i].se;
    }

    var shiftB = shiftBegin.split(':');
    shiftBegin = Number(shiftB[0]) * 60 + Number(shiftB[1]);
    var shiftE = shiftEnd.split(':');
    shiftEnd = Number(shiftE[0]) * 60 + Number(shiftE[1]);

    if( shiftEnd > shiftBegin) {
       startDayAt = Number(shiftB[0]);
       if(startDayAt > 1) startDayAt -= 1;
       dayEnd = Number(shiftE[0]) + 1;
    } else { // No valid shifts, show all day 
       startDayAt = 0;
       dayEnd = 24;
    }

    for(var j=0; j < dayLength ; j++)
      myOrder.push(0);

    var orderList = [];

    for( var wo in hashObj ) {
       hashObj[wo].order = 0;
       if(hashObj[wo].drawStartTime == undefined)
          hashObj[wo].drawStartTime = '08:00';
       var subItems =  hashObj[wo].drawStartTime.split(':');
       hashObj[wo].startOffset = Number(subItems[0]) * 60 + Number(subItems[1]);
       if(isNaN( hashObj[wo].startOffset ) )  hashObj[wo].startOffset = Number(hashObj[wo].drawStartTime) * 60;
       if(hashObj[wo].drawEndTime) {
          var endtime = hashObj[wo].drawEndTime.split(':');
          hashObj[wo].duration = Number(endtime[0])*60 + Number(endtime[1]) - hashObj[wo].startOffset;
       } else {
          hashObj[wo].duration = Number(hashObj[wo].drawTotalDuration || 60);
       }
       if(hashObj[wo].duration <= 15) hashObj[wo].duration = 15 ;
       orderList.push(hashObj[wo]);
    }

//    orderList.sort(function(a,b) { return b.duration - a.duration } );
    orderList.sort(function(a,b) { return a.startOffset - b.startOffset } );

    for(var i=0; i < orderList.length; i++) {
       if(orderList[i].startOffset < startDayAt * 60)
          startDayAt = Math.floor( orderList[i].startOffset/60 )
       if( (orderList[i].startOffset + orderList[i].duration) > dayEnd *60 )
          dayEnd = Math.floor(orderList[i].startOffset + orderList[i].duration) / 60 + 1;
       
       if (orderList[i].startOffset + orderList[i].duration > dayLength)
         dayLength = orderList[i].startOffset + orderList[i].duration;

//OBE       	if (orderList[i].startOffset + orderList[i].duration > dayLength)
//OBE	{
//OBE   orderList[i].duration = dayLength - orderList[i].startOffset;
//OBE	}

    }

//    if(dayEnd > 24) dayEnd = 24;
    var calBox = document.getElementById('calDiv');
    var calTable = '<table class="cal" width="99%" cellspacing=0 cellpadding=0>';
    for(var i = startDayAt; i < dayEnd; i++) {
      if( i % 24 == 0 && ( i != 0 || startDayAt < 0 ) ) {
        var d = new Date();
        var s =  new Date(d.valueOf() + i * 3600 * 1000);
            s = ( s.getMonth() + 1 ) + '/' + s.getDate();
//          alert(s);
//        s = s.split('/');
//        s.pop();
//        alert(s.join('/'));
        calTable  += '<tr><td class="label"><b><font color="blue">' + s + '</font></b></td><td style="border-top: 2px outset blue"></td></tr>';
      } else {
        calTable  += '<tr><td class="label">' + ( i % 24 < 0 ? 24 + (i % 24) : i % 24 ) + ":00" + '</td><td style="border-top: 1px solid grey"></td></tr>';
      }
      calTable  += '<tr><td></td><td style="border-top: 1px dotted grey"></td></tr>';
   }
   calBox.innerHTML = calTable + '</table>';

    var order = 1;
    while(orderList.length > 0 ) {
       for(var j=0; j < dayLength ; j++)
          myOrder[j] = 0;
       for( var i = 0; i < orderList.length; i++ ) {
          var wo = orderList[i];
          for (var k = 0; k < wo.duration; k++) {
            if(myOrder[wo.startOffset + k] != 0 ) {
               break;
            }
          }
          if( k >= wo.duration) {
            for (k = 0; k < wo.duration; k++)
               myOrder[wo.startOffset + k] = 1;
            wo.order = order;
            wo.counted = 1;
          }
       }
       for ( var i= orderList.length -1; i >=0 ; i-- )
         if(orderList[i].counted) orderList.splice(i, 1);
       order ++;
    }

    for(var j=0; j < dayLength ; j++)
       myOrder[j] = 0;

    for( var wo in hashObj ) {
        orderList.push(hashObj[wo]);
    }

    orderList.sort(function(a, b) { return b.order - a.order; } );

    for( var i=0; i < orderList.length; i++) {
       orderList[i].divideBy = orderList[i].order;
       for (var k = 0; k < orderList[i].duration; k++) {
          orderList[i].divideBy = Math.max(orderList[i].divideBy,  myOrder[orderList[i].startOffset + k]);
       }
       for (var k = 0; k < orderList[i].duration; k++) {
          myOrder[orderList[i].startOffset + k] = orderList[i].divideBy;
       }
//       console.log(orderList[i].woNumber + " : " + orderList[i].order + " of " + orderList[i].divideBy);
    }


    var rect = calBox.getClientRects()[0];
    for (var topPos = 0, el = calBox;  el != null; topPos += el.offsetTop, el = el.offsetParent);
    for (var leftPos = 0, el = calBox;  el != null; leftPos += el.offsetLeft, el = el.offsetParent);
//    topPos += 30 + 1;
//    leftPos += 55;
    topPos = 30;
    leftPos = 55;

    var totalWidth = rect.right - rect.left - 55 - 10;
    for(var i = 0; i < shifts.length; i++ ) {
       var shiftB = shifts[i].ss.split(':');
       shiftBegin = Number(shiftB[0]) * 60 + Number(shiftB[1]);
       var shiftE = shifts[i].se.split(':');
       shiftEnd = Number(shiftE[0]) * 60 + Number(shiftE[1]);

       var shiftDiv = document.createElement('div');
         shiftDiv.setAttribute('id', 'shiftPan' + i );
         shiftDiv.className = "shift";
         shiftDiv.style.top = (topPos + shiftBegin - startDayAt * 60) + "px";
         shiftDiv.style.height = (shiftEnd - shiftBegin) + 'px';
         shiftDiv.style.width = totalWidth + 15;
         shiftDiv.style.left = leftPos - 5 + 'px';
         calBox.appendChild(shiftDiv);
    }
//       document.body.appendChild(shiftDiv);

    var timerSpan =  document.createElement('div');
       timerSpan.className = 'timerline';
       timerSpan.setAttribute('id', 'timerPan');
       var d = new Date();
       if( d.getHours() <= dayEnd) {
         timerSpan.style.top = topPos + d.getHours()* 60 + d.getMinutes() - startDayAt * 60 - 1;
         timerSpan.style.width = totalWidth + 12;
         timerSpan.style.left = leftPos - 8 + 'px';
         timerSpan.style.height = '5px';
         timerSpan.innerHTML = '<div class="dot"></div><span><h5></h5><span/>';
         calBox.appendChild(timerSpan);
       }

    orderList.sort(function(a, b) { return b.duration - a.duration } ); //in case overlapping, shortest one on top
    for(var w=0; w < orderList.length; w++ ) {
       wo = orderList[w].woNumber;
       var woObj = hashObj[wo]; 
       var x = document.createElement("div");
       x.setAttribute('id', wo);
       x.className = "job " +  ( woObj.drawState || woObj.woJobNumber.substr(woObj.woJobNumber.indexOf('[')+1, 2) ) + (woObj.enrouted ? " " + woObj.enrouted : '');
       x.style.top = topPos + woObj.startOffset - startDayAt * 60;
       x.style.height = (woObj.duration > 15 ? woObj.duration -2 : 15 ) + 'px';
       x.style.width = totalWidth / woObj.divideBy -5;
       x.style.left = leftPos +  totalWidth * (woObj.order -1) / woObj.divideBy  + 'px';
       x.innerHTML =  "<h5>" + woObj.Symbol + woObj.woJobNumber + "</h5><div>" + woObj.lineItems.join('<br/>') + '</div>';
       calBox.appendChild(x);
//       console.log(wo + ": order " + woObj.order + " of " + woObj.divideBy + " : " + woObj.duration + " min, starting at " + woObj.drawStartTime);

       if(x.addEventListener) {
          x.addEventListener("click", woSelect, false);
       } else {
          x.onclick = woSelect;
       }
    }

    window.delayTimer = undefined;
    window.onorientationchange = function(event) {
       window.delayTimer = setTimeout('orientation_changed()', 250);
    }
    window.orientation_changed = function (){
        var calBox = document.getElementById('calDiv');
        var rect = calBox.getClientRects()[0];
        for (var topPos = 0, el = calBox;  el != null; topPos += el.offsetTop, el = el.offsetParent);
        for (var leftPos = 0, el = calBox;  el != null; leftPos += el.offsetLeft, el = el.offsetParent);
        topPos += 30 + 1;
        leftPos += 55;
        var totalWidth = rect.right - rect.left - 55 - 10;
        for( var wo in hashObj ) {
          var x = document.getElementById(wo);
          x.style.width = totalWidth / hashObj[wo].divideBy -5;
          x.style.left = leftPos +  totalWidth * (hashObj[wo].order -1) / hashObj[wo].divideBy + 'px';
      }

      for(var i = 0; i < shifts.length; i++ ) {
       var shiftB = shifts[i].ss.split(':');
       shiftBegin = Number(shiftB[0]) * 60 + Number(shiftB[1]);
       var shiftDiv = document.getElementById('shiftPan' + i);
       shiftDiv.style.top = topPos + shiftBegin - startDayAt * 60;
       shiftDiv.style.width = totalWidth + 15;
       shiftDiv.style.left = leftPos - 5 + 'px';
    }

      var timerSpan = document.getElementById('timerSpan');
      if(timerSpan) {
         timerSpan.style.top = topPos + d.getHours()* 60 + d.getMinutes() - startDayAt * 60 - 1;
         timerSpan.style.width = totalWidth + 12;
         timerSpan.style.left = leftPos -8 + 'px';
      }
      clearTimeout(window.delayTimer);
    }
  initalert();
}




function logoff(reason)
{
    var req = 'Id=71&reason=' + reason;

	 if( (reason === "EOD" && 0 ) ||
		  (reason === "LOFFT" && 0 ) )
	 {
		  var track = reason === "EOD" ? 0 : 0;
		  req += "&trackGps=" + track;
		  if( track == "1")
	     {
				if (navigator.geolocation) {
					 navigator.geolocation.getCurrentPosition(
						  function (loc) {
								req += "&Latitude=" + loc.coords.latitude;
								req += "&Longitude=" + loc.coords.longitude;
								req += "&Speed=" + ( loc.coords.speed || '');
								back_it(req);
						  },
						  function (geoPositionError) {
								var rx = "";
								switch (geoPositionError.code) {
									 case 0: // UNKNOWN_ERROR
										  rx="An unknown error occurred, sorry";
									 break;
									 case 1: // PERMISSION_DENIED
										  rx = "Permission to use Geolocation was denied";
									 break;
									 case 2: // POSITION_UNAVAILABLE
										  rx = "Could not find you...";
									 break;
									 case 3: // TIMEOUT
										  rx = "The Geolocation request took to long and timed out";
									 break;
								  default:
								}
								//alert(rx);
								back_it(req);
						  },
              { timeout: 4000, maximumAge: 60000, enableHighAccuracy: true } );
					 return false;
				}
	         else {
					 //alert("I am sorry, but Geolocation is not supported in your current browser");
				}
		  }
	 }
    back_it(req);
}
-->
</script>
</head>
<body onload="on_load()">
<form name="choices" action="">
<input type="hidden" name="Id" value="29">
<input type="hidden" name="mainVal" value="1">
<input type="hidden" name="historicalWo" value="0">
<input type="hidden" name="fromHistTbl" value="0">
<input type="hidden" name="ackJobList">
<input type="hidden" name="XgeoX">
<input type="hidden" name="EsVal" value="3">
<table align="center" class="rowborder" width="100%">
<tbody><tr><th height="35px" bgcolor="#98C0F4" align="center" colspan="2" valign="middle">
(178014134) - <font color="#FFFFFF"> <label id="ts"> LoggedOn </label> </font>  </th></tr>
<tr><td colspan="2">
<input type="hidden" name="TsVal" value="">
<input type="hidden" name="trackGps" value="">
<input type="hidden" name="Latitude" value="">
<input type="hidden" name="Longitude" value="">
<input type="hidden" name="Speed" value="">

<select name="techStatus" onchange="if(this.selectedIndex &lt; 1) return;document.choices.TsVal.value=this.options[this.selectedIndex].value;changeStatus('6')">
<option value="-2" selected="selected">- - - Tech Status - - -</option>
<option value="AVAIL" trackgps="0">Available</option>
<option value="ENROUTE" trackgps="0">EnRoute</option>
<option value="BREAK" trackgps="0">Break</option>
<option value="LUNCH" trackgps="0">Lunch</option>

</select>


<div class="button mail"><div id="MsgCountID" style="display:table-cell;vertical-align: middle; text-align:center; font-weight:bold;" onclick="changeStatus('4')"> 15 </div></div>

</td></tr>


<tr><td colspan="2">
<select name="mVal" onchange="changeStatus(this.form.mVal.options[this.form.mVal.selectedIndex].value)">
  <option value="-2" selected="selected">- - - Select Action - - -</option>
<option value="14">EOD Summary</option>
<option value="13">Receipt</option>
<option value="5">Directions</option>
<option value="11">Phone Directory</option>
<option value="12">Version</option>
<option value="16">Change Password</option>
<option value="24">Configuration</option>
</select>
</td>
</tr>
<tr><th bgcolor="#98C0F4" align="center" colspan="2">Jobs(0)</th></tr>
<tr><td colspan="2" style="padding-left:3px">
   <input type="hidden" name="woNumAndJob" value="-99:-99:1">
   <div id="pastJobs"> </div>
   <div id="curDay" style="width:99.5%"><h4>Current</h4>
     <div id="calDiv" style="position:relative; top:+1px;padding:30 0 0 0; margin: 0 0 0 0;background-color:white;/*border-style:solid;border-size:2px;border-color:blue;*/"><table class="cal" width="99%" cellspacing="0" cellpadding="0"><tbody><tr><td class="label">7:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">8:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">9:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">10:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">11:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">12:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">13:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">14:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">15:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">16:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">17:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr><tr><td class="label">18:00</td><td style="border-top: 1px solid grey"></td></tr><tr><td></td><td style="border-top: 1px dotted grey"></td></tr></tbody></table><div id="shiftPan0" class="shift" style="top: 90px; height: 600px; width: 1219.61px; left: 50px;"></div><div id="0783680049702C1204:07836800497:1" class="job CP" style="top: 607px; height: 141px; width: 1199.61px; left: 55px;"><h5>07836800497 [CP:2-5:IN]</h5><div><b>Job ID:</b> 07836800497<br><b>Tech:</b> 18232<br><b>ResCd:</b> None<br><b>FC:</b> 178014134<br><b>Create:</b> 12/04/2025 19:42<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 19:00<br><b>DS:</b> Complete<br><b>TS:</b> 2-5<br><b>Type:</b> IN<br><b>Units:</b> 11<br><b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][15:Rec PriInternet&amp;Soft]<br><b>Addr:</b> 45 HINCKLEY PL<br><b>Addr2:</b> APT 5C<br><b>City:</b> BROOKLYN, NY 11218<br><b>Name:</b> RAHMAN,MAISHA<br><b>Home #:</b> 917-232-4238<br><b>Work #:</b> 917-232-4238<br><b>Map CD:</b> 992-<br><b>Job Cmt:</b> <br><b>Node:</b> 32E221<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Checked signals, installed new modem 3.1<br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div><div id="078361428391201203:07836142839:1" class="job CP" style="top: 96px; height: 131px; width: 1199.61px; left: 55px;"><h5>07836142839 [CP:8-11:IN]</h5><div><b>Job ID:</b> 07836142839<br><b>Tech:</b> 18232<br><b>ResCd:</b> None<br><b>FC:</b> 178014134<br><b>Create:</b> 12/03/2025 20:10<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 10:19<br><b>DS:</b> Complete<br><b>TS:</b> 8-11<br><b>Type:</b> IN<br><b>Units:</b> 15<br><b>ReaCd/ReaDesc:</b> [33:Code Change][2:Rec Primary Video][33:Code Change][11:Install A/O][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][165:Stream]<br><b>Addr:</b> 1831 FULTON ST<br><b>Addr2:</b> APT 1C<br><b>City:</b> BROOKLYN, NY 11233-2210<br><b>Name:</b> BREVOORT,RESIDENT<br><b>Home #:</b> 347-683-1230<br><b>Work #:</b> 347-683-1230<br><b>Map CD:</b>  39Z<br><b>Job Cmt:</b> Waiting for customer<br><b>Node:</b> 35D165<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Checked wires, signals, installed new modem 3.1. Customer educated<br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div><div id="0783654398203H1205:07836543982:1" class="job CP" style="top: 398px; height: 100px; width: 1199.61px; left: 55px;"><h5>07836543982 [CP:11-2:COS]</h5><div><b>Job ID:</b> 07836543982<br><b>Tech:</b> 18232<br><b>ResCd:</b> None<br><b>FC:</b> 178014134<br><b>Create:</b> 12/05/2025 10:40<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 14:50<br><b>DS:</b> Complete<br><b>TS:</b> 11-2<br><b>Type:</b> COS<br><b>Units:</b> 9<br><b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][33:Code Change][29:Up/Down Serv]<br><b>Addr:</b> 57 LINCOLN RD<br><b>Addr2:</b> APT B14<br><b>City:</b> BROOKLYN, NY 11225-4058<br><b>Name:</b> LIENKE,JULIA<br><b>Home #:</b> 323-481-5023<br><b>Work #:</b> 323-481-5023<br><b>Map CD:</b>  33R<br><b>Job Cmt:</b> <br><b>Node:</b> 35E431<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Changed fitting, checked signals, swap modem, provision 1G internet speed. Customer educated.<br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div><div id="078368653810661207:07836865381:1" class="job CP" style="top: 514px; height: 74px; width: 1199.61px; left: 55px;"><h5>07836865381 [CP:2-5:TC]</h5><div><b>Job ID:</b> 07836865381<br><b>Tech:</b> 18232<br><b>ResCd:</b> [111][280]<br><b>FC:</b> 178014134<br><b>Create:</b> 12/07/2025 13:22<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 16:20<br><b>DS:</b> Complete<br><b>TS:</b> 2-5<br><b>Type:</b> TC<br><b>Units:</b> 9<br><b>ReaCd/ReaDesc:</b> [153:Slow Internet Speed][200:Diagnosis/Check Grnd]<br><b>Addr:</b> 177 WOODRUFF AV<br><b>Addr2:</b> APT 101<br><b>City:</b> BROOKLYN, NY 11226<br><b>Name:</b> QUIRICO,QUINCY<br><b>Home #:</b> 347-772-7937<br><b>Work #:</b> 347-772-7937<br><b>Map CD:</b>  31R<br><b>Job Cmt:</b> 3477727937<br><b>Node:</b> 32E101<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Ran new drop wires, rebooted modem.<br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div><div id="0783655041201y1208:07836550412:1" class="job CP" style="top: 312px; height: 71px; width: 1199.61px; left: 55px;"><h5>07836550412 [CP:11-2:TC]</h5><div><b>Job ID:</b> 07836550412<br><b>Tech:</b> 18232<br><b>ResCd:</b> [213][261]<br><b>FC:</b> 178014134<br><b>Create:</b> 12/08/2025 09:40<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 12:55<br><b>DS:</b> Complete<br><b>TS:</b> 11-2<br><b>Type:</b> TC<br><b>Units:</b> 18<br><b>ReaCd/ReaDesc:</b> [402:2nd Repeat TC][162:HSD /Intermt/A-Otlts][200:Diagnosis/Check Grnd][915:MedLifeAlrt][336:Svc Call Fee Waived][902:OASPRI]<br><b>Addr:</b> 301 STERLING ST<br><b>Addr2:</b> APT 5H<br><b>City:</b> BROOKLYN, NY 11225-4140<br><b>Name:</b> TURNER,DOROTHY<br><b>Home #:</b> 718-773-4631<br><b>Work #:</b> 917-294-8088<br><b>Map CD:</b>  33T<br><b>Job Cmt:</b> (917)294-8088<br><b>Node:</b> 35E128<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Changed fittings, removed unnecessary splitters  <br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div><div id="0783606893406A1203:07836068934:1" class="job CP" style="top: 243px; height: 53px; width: 1199.61px; left: 55px;"><h5>07836068934 [CP:11-2:COS]</h5><div><b>Job ID:</b> 07836068934<br><b>Tech:</b> 18232<br><b>ResCd:</b> None<br><b>FC:</b> 178014134<br><b>Create:</b> 12/03/2025 15:38<br><b>Schd:</b> 12/08/2025<br><b>CpTime:</b> 12/08/2025 11:28<br><b>DS:</b> Complete<br><b>TS:</b> 11-2<br><b>Type:</b> COS<br><b>Units:</b> 9<br><b>ReaCd/ReaDesc:</b> [33:Code Change][170:BringGW6(D3.1AX)][33:Code Change][33:Code Change][29:Up/Down Serv]<br><b>Addr:</b> 674 MADISON ST<br><b>Addr2:</b> APT 2<br><b>City:</b> BROOKLYN, NY 11221-2106<br><b>Name:</b> TYBERG,JAMIE<br><b>Home #:</b> 404-483-9463<br><b>Work #:</b> 404-483-9463<br><b>Map CD:</b>  41Y<br><b>Job Cmt:</b> <br><b>Node:</b> 35C165<br><b>Delq:</b> <br><b>Dispatch Cmt:</b> Rebooted modem, changing service<br><b>Receipt Cmt:</b> <br><b>FSM Cmt:</b> </div></div></div></div></td></tr>
<tr>
  <td align="center" colspan="2">
    <input type="button" value="End of Day" onclick="logoff('EOD')">
  <input type="button" value="Log Off" onclick="logoff('LOFFT')">
  </td>
</tr>
</tbody></table>
</form>
<div id="detailPan" style="display:none;"></div>


</body></html>